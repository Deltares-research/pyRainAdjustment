<?xml version="1.0" encoding="UTF-8"?>
<generalAdapterRun xmlns="http://www.wldelft.nl/fews" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.wldelft.nl/fews http://fews.wldelft.nl/schemas/version1.0/generalAdapterRun.xsd">
	<general>
		<description>Adjust a gridded rainfall product with the available rain gauges</description>
		<rootDir>%REGION_HOME%/Modules/pyRainAdjustment</rootDir>
		<workDir>%ROOT_DIR%</workDir>
		<exportDir>%ROOT_DIR%/input</exportDir>
		<exportDataSetDir>%ROOT_DIR%</exportDataSetDir>
		<exportIdMap>IdHSAFNowcast</exportIdMap>
		<importDir>%ROOT_DIR%/output</importDir>
		<importIdMap>IdAdjustmentFactor</importIdMap>
		<dumpFileDir>$GA_DUMPFILEDIR$</dumpFileDir>
		<dumpDir>%ROOT_DIR%</dumpDir>
		<diagnosticFile>%ROOT_DIR%/pyRainAdjustment_module_diag.xml</diagnosticFile>
	</general>
	<activities>
		<startUpActivities>
			<purgeActivity>
				<filter>%ROOT_DIR%/input/*</filter>
			</purgeActivity>
			<purgeActivity>
				<filter>%ROOT_DIR%/output/*</filter>
			</purgeActivity>
			<purgeActivity>
				<filter>%ROOT_DIR%/logs/*</filter>
			</purgeActivity>
		</startUpActivities>
		<exportActivities>
			<exportDataSetActivity>
				<moduleInstanceId>$MODULEINSTANCE_ID$</moduleInstanceId>
			</exportDataSetActivity>
			<exportNetcdfActivity>
				<exportFile>TAHMO_Gauges.nc</exportFile>
				<netcdfFormat>netcdf4</netcdfFormat>
				<timeSeriesSets>
					<timeSeriesSet>
					   <moduleInstanceId>Import_TAHMO</moduleInstanceId>
					   <valueType>scalar</valueType>
					   <parameterId>P.obs</parameterId>
					   <locationSetId>GA_Gauged_Meteo_TAHMO</locationSetId>
						<timeSeriesType>external historical</timeSeriesType>
						<timeStep unit="hour" multiplier="1" timeZone="GMT"/>
						<relativeViewPeriod unit="hour" end="0" start="-1" startOverrulable="true" endOverrulable="false"/>
						<readWriteMode>read only</readWriteMode>
						<synchLevel>1</synchLevel>
					</timeSeriesSet>
				</timeSeriesSets>
				<checkMissing>true</checkMissing>
			</exportNetcdfActivity>
			<exportNetcdfActivity>
				<exportFile>ADCON_Gauges.nc</exportFile>
				<netcdfFormat>netcdf4</netcdfFormat>
				<timeSeriesSets>
					<timeSeriesSet>
					   <moduleInstanceId>Import_ADCON</moduleInstanceId>
					   <valueType>scalar</valueType>
					   <parameterId>P.obs</parameterId>
					   <locationSetId>GA_Gauged_Meteo_ADCON</locationSetId>
						<timeSeriesType>external historical</timeSeriesType>
						<timeStep unit="hour" multiplier="1" timeZone="GMT"/>
						<relativeViewPeriod unit="hour" end="0" start="-1" startOverrulable="true" endOverrulable="false"/>
						<readWriteMode>read only</readWriteMode>
						<synchLevel>1</synchLevel>
					</timeSeriesSet>
				</timeSeriesSets>
				<checkMissing>true</checkMissing>
			</exportNetcdfActivity>
			<exportNetcdfActivity>
				<exportFile>gridded_rainfall.nc</exportFile>
				<netcdfFormat>netcdf4</netcdfFormat>
				<timeSeriesSets>
					<timeSeriesSet>
						<moduleInstanceId>$ID_GRIDDED_RAINFALL$</moduleInstanceId>
						<valueType>grid</valueType>
						<parameterId>P.obs</parameterId>
						<locationId>$LOCATION_ID$</locationId>
						<timeSeriesType>external historical</timeSeriesType>
						<timeStep unit="hour" multiplier="1" timeZone="GMT"/>
						<relativeViewPeriod unit="hour" end="0" start="-1" startOverrulable="true" endOverrulable="false"/>
						<readWriteMode>read only</readWriteMode>
					</timeSeriesSet>
				</timeSeriesSets>
				<checkMissing>true</checkMissing>
			</exportNetcdfActivity>
			<exportRunFileActivity>
				<exportFile>adjustment_settings.xml</exportFile>
				<properties>
					<string key="adjustment_method" value="$ADJUSTMENT_METHOD$"/>
					<string key="statistical_function" value="$STATISTICAL_FUNCTION$"/>					
					<float key="threshold" value="$THRESHOLD$"/>
					<float key="max_change_factor" value="$MAX_CHANGE_FACTOR$"/>
					<int key="nearest_cells_to_use" value="$NEAREST_CELLS_TO_USE$"/>
					<int key="min_gauges" value="$MIN_GAUGES$"/>
					<int key="kriging_n_gauges" value="$KRIGING_N_GAUGES$"/>
					<string key="interpolation_method" value="$INTERPOL_METHOD$"/>
				</properties>
			</exportRunFileActivity>
		</exportActivities>
		<executeActivities>
			<executeActivity>
				<command>
					<executable>%REGION_HOME%/Modules/python/python.exe</executable>
				</command>
				<arguments>
					<argument>main.py</argument>
					<argument>--xml_config</argument>
					<argument>input/adjustment_settings.xml</argument>
					<argument>--requested_functionality</argument>
					<argument>adjustment</argument>
				</arguments>
				<console>
					<redirectToLogFile>%ROOT_DIR%/logs/%TIME0%_pyRainAdjustment_console.txt</redirectToLogFile>
				</console>
				<logFile>
					<file>%ROOT_DIR%/logs/log_pyRainAdjustment.txt</file>
                    <infoLinePattern>*INFO*</infoLinePattern>
                    <warningLinePattern>*WARNING*</warningLinePattern>
                    <debugLinePattern>*DEBUG*</debugLinePattern>
                    <errorLinePattern>*ERROR*</errorLinePattern>
				</logFile>
				<timeOut>4000000</timeOut>
				<ignoreDiagnostics>true</ignoreDiagnostics>
			</executeActivity>
		</executeActivities>
		<importActivities>
			<importNetcdfActivity>
				<importFile>%ROOT_DIR%/output/adjustment_factors_gridded_rainfall.nc</importFile>
				<timeSeriesSets>
					<timeSeriesSet>
						<moduleInstanceId>$MODULEINSTANCE_ID$</moduleInstanceId>
						<valueType>grid</valueType>
						<parameterId>F.adj</parameterId>
						<locationId>$LOCATION_ID$</locationId>
						<timeSeriesType>external historical</timeSeriesType>
						<timeStep unit="hour" multiplier="1" timeZone="GMT"/>
						<readWriteMode>add originals</readWriteMode>
					</timeSeriesSet>
				</timeSeriesSets>
			</importNetcdfActivity>
		</importActivities>
	</activities>
</generalAdapterRun>
