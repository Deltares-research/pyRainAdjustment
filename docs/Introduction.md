# Introduction
pyRainAdjustment is an open-source Python toolset to downscale and correct gridded rainfall products using rain gauges. This tool interacts with Delft-FEWS and takes as input a netCDF of gridded rainfall (or other meteorological) product and one or multiple netCDF(s) containing the rain gauge information. It returns a field of correction factors as a netCDF that can be read by Delft-FEWS.

pyRainAdjustment uses the wradlib Python package (Heistermann et al., 2013) as backbone. The tool uses a gridded precipitation dataset (hindcast or forecast) in netCDF format as input together with the rain gauge data (netCDF format containing all available gauges; only in hindcasting mode) and a configuration file, which can easily be exported and called through Delft-FEWS. The spatial grid projection (e.g., WGS84 or Lambert, etc.) does not matter, as long as the projection, latitude and longitude values are defined in the exported netCDF (this automatically happens through Delft-FEWS). 

Based on the requested configuration, either downscaling, hindcasting corrections (MFB, additive, multiplicative, mixed or KED adjustments) or forecasting (quantile mapping) corrections are applied. In the case of quantile mapping, the statistics can (1) either be derived from a historical dataset or (2) applied when already derived and when a forecast is available in real time. Based on the requested functionality, pyRainAdjustment will apply the downscaling or adjustment and returns the downscaled/adjusted gridded precipitation together with the adjustment factor when adjustment has taken place.

pyRainAdjustment offers the following tools:
- Gridded rainfall downscaling using a climatology-based downscaling procedure.
- Gridded rainfall adjustment in a hindcasting mode. For this, the following methods can be used: mean field bias adjustments, additive, multiplicative and mixed error model correction, and kriging with external drift adjustment.
- Gridded rainfall adjustment in a forecasting mode through quantile mapping.

In hindcasting mode, or when deriving the quantiles for the quantile mapping application, grid cells have to be matched with the provided rain gauges. pyRainAdjustment uses one of wradlib’s tools for that, which searches for the closest grid cell given a rain gauge location, based on the distance between the gauge and the centre of the grid cell (given the latitude and longitude coordinates). Provided that many gridded rainfall products are estimates based on remotely sensed observations (e.g., from radar or satellite), we generally get a gridded rainfall estimate at a specific altitude above ground (typically 1500 m for radar), meaning that what we see on the gridded QPE, is not necessarily what falls on the ground, besides the error that comes with remotely sensed estimates from rainfall anyway. Hence, it is often better to search the corresponding grid cell(s) with a specific radius around the rain gauge. This is possible with a ‘search box’ in which the closest `n` cells are searched for around the rain gauge. When this box of cells is found, the user can still define whether to use the best matching cell (with the gauge) for the adjustment procedure, or the median, mean, minimum or maximum of all cells (see the figure below).

![image](https://github.com/user-attachments/assets/3a216a3c-9e18-4d13-9e66-f8ad0f350176)
Example of the search function to find the corresponding grid cell(s) for a provided gauge location in pyRainAdjustment. This example, tested over Accra, Ghana, uses the median value of the nine grid cells around the gauge of interest.

## Navigating through the rest of the documentation
A background on the various options and methods in pyRainAdjustment is provided under: [/docs/Downscaling.md](https://github.com/Deltares-research/pyRainAdjustment/tree/main/docs/Downscaling.md) for the downscaling method, [/docs/Hindcasting_adjustments.md](https://github.com/Deltares-research/pyRainAdjustment/tree/main/docs/Hindcasting_adjustment.md) for the adjustment methods in hindcasting mode and [/docs/Forecasting_adjustment.md](https://github.com/Deltares-research/pyRainAdjustment/tree/main/docs/Forecasting_adjustment.md) for the adjustment methods in forecasting mode. Examples of how to configure these options in Delft-FEWS are provided in the folder `config` and this is further explained in [/config/README.md](https://github.com/Deltares-research/pyRainAdjustment/tree/main/config/README.md).

## References
Heistermann, M., S. Jacobi, and T. Pfaff. ‘Technical Note: An Open Source Library for Processing Weather Radar Data (Wradlib)’. Hydrology and Earth System Sciences 17, no. 2 (28 February 2013): 863–71. https://doi.org/10.5194/hess-17-863-2013.
